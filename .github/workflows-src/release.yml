name: release
on:
  push:
    branches:
      - main
jobs:
  %build%
  %lint%
  %test_jest%
  %docs%
  %demo_app%
  %test_integration%
  deploy:
    runs-on: ubuntu-latest
    needs: [build]
    env:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
      GH_TOKEN: ${{ secrets.GH_TOKEN_REDALLEN }}
      GH_PR_TOKEN: ${{ secrets.GH_PR_TOKEN }}
    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.GH_TOKEN_REDALLEN }} # needs to be an admin token to get around branch protection
      %install%
      %dist%
      - name: Avoid Unknown Host for github.com
        run: mkdir ~/.ssh/ && echo -e "Host github.com\n\tStrictHostKeyChecking no\n" > ~/.ssh/config
      - name: Deploy to NPM and Github
        run: .github/release.sh

